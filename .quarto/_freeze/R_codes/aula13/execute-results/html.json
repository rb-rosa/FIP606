{
  "hash": "c7b7d5644c080b132d9559c305819fe8",
  "result": {
    "markdown": "---\ntitle: \"**Simples, Misto e GLM**\"\nformat: html\n\nexecute: \n  freeze: auto\n  cache: true\n  warning: false\n---\n\n\nAula 13\n\nAnálise de regressão estuda a relação entre uma variável dependente (resposta) e outras variáveis independentes (explicativas).Ela permite construir um modelo matemático que represente dois atributos x e y. A análise de regressão indica o efeito de uma mudança da unidade na variável explicativa (x) em relação a variável resposta (y). Ela descreve o efeito, por meio de uma equação, da variável explicativa em relação a variável resposta.\n\nJá a correlação linear, resume (mensura) o grau de associação entre duas variáveis (x e y). Fornece um número que resume o grau de associação entre a duas variáveis.\n\nPara fatores com níveis quantitavos se faz análise de regressão e não de média. Para essa aula, será feita análise de regressão (fator quantitativo). O objetivo é ajustar um modelo (função ou equação) teórico que permite estimar qualquer valor (3,2,2.6,6....). Nesse caso, queremos saber se há efeito significativo do inóculo na taxa de emergência, se não tiver efito, é observado uma linha reta, mas se tiver, a reta terá uma inclinação (snoop = coeficiente angular da reta). Se o snoop for zero, o ângulo é zero. O p-valor da regressão é se o snoop (diminuição ou aumento) é significativamente diferetne de zero.\n\nO primeiro passo é fazer uma análise exploratório de representação com o gráfico geom_point, depois ajusta o modelo ao colocar a tendência (regressão linear) de primeira ordem (há dois parâmetros ou coeficientes).\n\nUsar modelo misto ou simples, não os dois\n\n\n::: {.cell hash='aula13_cache/html/unnamed-chunk-1_bbb15be46a0e22bb365d314a6184d604'}\n\n```{.r .cell-code}\nlibrary(readxl)\nlibrary(tidyverse)\nlibrary(dplyr)\nestande <- read_excel(\"dados-diversos.xlsx\", \"estande\")\n\nestande |> \n  ggplot(aes(trat, nplants,))+\n  geom_point()+\n  ylim(0, max(estande$nplants))+\n  #linha de tendência é uma linha suavisada para ver o padrão\n  geom_smooth(se = F, method = \"lm\")\n```\n\n::: {.cell-output-display}\n![](aula13_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n## Modelo linear simples (fator fixo)\n\n\n::: {.cell hash='aula13_cache/html/unnamed-chunk-2_3ad683723f8fd1b46bb3c9073c6b86f6'}\n\n```{.r .cell-code}\nexp1 <- estande |> \n  filter(exp == 1)\n# nplants é a resposta\nm1 <- lm(nplants ~ trat, data = exp1)\nsummary(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = nplants ~ trat, data = exp1)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-25.500  -6.532   1.758   8.573  27.226 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  52.5000     4.2044  12.487 1.84e-11 ***\ntrat         -0.2419     0.1859  -1.301    0.207    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 15 on 22 degrees of freedom\nMultiple R-squared:  0.07148,\tAdjusted R-squared:  0.02928 \nF-statistic: 1.694 on 1 and 22 DF,  p-value: 0.2066\n```\n:::\n\n```{.r .cell-code}\nexp2 <- estande |> \n  filter(exp == 2)\n\n# nplants é a resposta\nm2 <- lm(nplants ~ trat, data = exp2)\nsummary(m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = nplants ~ trat, data = exp2)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-25.7816  -7.7150   0.5653   8.1929  19.2184 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  60.9857     3.6304  16.798 4.93e-14 ***\ntrat         -0.7007     0.1605  -4.365 0.000247 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 12.95 on 22 degrees of freedom\nMultiple R-squared:  0.4641,\tAdjusted R-squared:  0.4398 \nF-statistic: 19.05 on 1 and 22 DF,  p-value: 0.0002473\n```\n:::\n\n```{.r .cell-code}\nexp3 <- estande |> \n  filter(exp == 3)\n\n# nplants é a resposta\nm3 <- lm(nplants ~ trat, data = exp3)\nsummary(m3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = nplants ~ trat, data = exp3)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-26.5887  -3.9597   0.7177   5.5806  19.8952 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  95.7500     2.9529  32.425  < 2e-16 ***\ntrat         -0.7634     0.1306  -5.847 6.97e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 10.53 on 22 degrees of freedom\nMultiple R-squared:  0.6085,\tAdjusted R-squared:  0.5907 \nF-statistic: 34.19 on 1 and 22 DF,  p-value: 6.968e-06\n```\n:::\n\n```{.r .cell-code}\n# Modelo de regressão linear simples: y= B0 + B1*X\n# B0 = beta zero (interceptor): é o valor no qual a linha ajsutada cruza o eixo Y. Interpretação: é o valor médio de resposta quando todas as variáveis explicativas são definidas como zero.No m3, se o trat (número de inóculos) for igual a zero, o valor médio seria 95.7500.\n# B1 = \"trat\" (a cada aumento de uma unidade do trat, espera-se uma diminuição média de -0.7634 (m3) no número de plantas (nplants))\n#x = variável explicativa\n\n#Adjusted R-squared: R², indica quantos porcento da variabilidade de y está sendo explicada por x.\n\n#Multiple R-squared:  0.6085 (m3): é uma medida que indica quão bem o medelo prevê os dados observados.\n\n# p-valor < 2e-16 *** (m3): é a probabilidade que a variável não seja relevante para o modelo. Quanto mais asterísticos presentes ao lado do efeito estimado, maior o nível de confiança com o que podemos afirmar que o efeito não é nulo. Ou seja, se o p-valor for menor que 0.05 a variável é significativa para o modelo, ou seja, as alterações na variável explicativa influenciam nas alterações da variável resposta. Se o p-valor for >0.05, sugere que as mudanças na variável explicativa não estão associadas as mudanças na variável resposta.\n\n#Residuals (m3): informações referente aos resíduos do modelo. É a diferença do valor previsto e o valor real.\n\n\n\nlibrary(report)\nreport(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nWe fitted a linear model (estimated using OLS) to predict nplants with trat\n(formula: nplants ~ trat). The model explains a statistically not significant\nand weak proportion of variance (R2 = 0.07, F(1, 22) = 1.69, p = 0.207, adj. R2\n= 0.03). The model's intercept, corresponding to trat = 0, is at 52.50 (95% CI\n[43.78, 61.22], t(22) = 12.49, p < .001). Within this model:\n\n  - The effect of trat is statistically non-significant and negative (beta =\n-0.24, 95% CI [-0.63, 0.14], t(22) = -1.30, p = 0.207; Std. beta = -0.27, 95%\nCI [-0.69, 0.16])\n\nStandardized parameters were obtained by fitting the model on a standardized\nversion of the dataset. 95% Confidence Intervals (CIs) and p-values were\ncomputed using a Wald t-distribution approximation.\n```\n:::\n\n```{.r .cell-code}\ng1 <- exp1 |> \n  ggplot(aes(trat, nplants))+\n  geom_point()+\n  geom_abline(intercept = 52.5, slope = -0.24)+\n    ylim(0, max(estande$nplants))+\n  #geom_smooth(method = \"lm\", se = F)+\n  annotate(geom =  \"text\", x = 24,\n           y = 70, label = \"y = 52.5 -0.24x\")\n\ng2 <- exp1 |> \n  ggplot(aes(trat, nplants))+\n  geom_point()+\n  ylim(0, max(estande$nplants))+\n  geom_smooth(method = \"lm\", se = F)+\n  annotate(geom =  \"text\", x = 24,\n           y = 70, label = \"y = 60 -0.7x\")\n\ng3 <- exp1 |> \n  ggplot(aes(trat, nplants))+\n  geom_point()+\n  ylim(0, max(estande$nplants))+\n  geom_smooth(method = \"lm\", se = F)+\n  annotate(geom =  \"text\", x = 24,\n           y = 70, label = \"y = 95 -0.7x\")\n\nlibrary(patchwork)\ng1 | g2 | g3\n```\n\n::: {.cell-output-display}\n![](aula13_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n## Modelo misto\n\nTem fator fixo e aleatório. Junta os 3 experimentos em um modelo só e compara se houve significancia nos 3 ou não.\n\n\n::: {.cell hash='aula13_cache/html/unnamed-chunk-3_ec41c58e7aa228f1caa97cf9fb08637a'}\n\n```{.r .cell-code}\nlibrary(lme4)\nmix <- lmer(nplants ~ trat + (trat | exp),\n        data = estande)\nsummary(mix)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLinear mixed model fit by REML ['lmerMod']\nFormula: nplants ~ trat + (trat | exp)\n   Data: estande\n\nREML criterion at convergence: 580.8\n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-2.0988 -0.6091  0.1722  0.6360  1.9963 \n\nRandom effects:\n Groups   Name        Variance  Std.Dev. Corr \n exp      (Intercept) 510.68405 22.5983       \n          trat          0.05516  0.2349  -0.82\n Residual             167.91303 12.9581       \nNumber of obs: 72, groups:  exp, 3\n\nFixed effects:\n            Estimate Std. Error t value\n(Intercept)  69.7452    13.2146   5.278\ntrat         -0.5687     0.1643  -3.462\n\nCorrelation of Fixed Effects:\n     (Intr)\ntrat -0.731\noptimizer (nloptwrap) convergence code: 0 (OK)\nModel failed to converge with max|grad| = 0.00274249 (tol = 0.002, component 1)\n```\n:::\n\n```{.r .cell-code}\nlibrary(car)\nAnova(mix)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Deviance Table (Type II Wald chisquare tests)\n\nResponse: nplants\n      Chisq Df Pr(>Chisq)    \ntrat 11.985  1  0.0005362 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n::: {.cell hash='aula13_cache/html/unnamed-chunk-4_1d06001ae081f13889f69e40ee88fec3'}\n\n```{.r .cell-code}\nestande |> \n  ggplot(aes(trat, nplants, group = exp))+\n  geom_point()+\n  ylim(0, max(estande$nplants))+\n  #linha de tendência é uma linha suavisada para ver o padrão\n  geom_smooth(se = F, method = \"lm\")\n```\n\n::: {.cell-output-display}\n![](aula13_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n### Modelo GLM\n\nModelo linear é um caso especial do GLM\n\n\n::: {.cell hash='aula13_cache/html/unnamed-chunk-5_73ad304bf3db0a545254828121b5af7a'}\n\n```{.r .cell-code}\nlm1 <- lm(nplants ~ trat, data = exp3)\nsummary(lm1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = nplants ~ trat, data = exp3)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-26.5887  -3.9597   0.7177   5.5806  19.8952 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  95.7500     2.9529  32.425  < 2e-16 ***\ntrat         -0.7634     0.1306  -5.847 6.97e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 10.53 on 22 degrees of freedom\nMultiple R-squared:  0.6085,\tAdjusted R-squared:  0.5907 \nF-statistic: 34.19 on 1 and 22 DF,  p-value: 6.968e-06\n```\n:::\n\n```{.r .cell-code}\n# glm \"gaussian\" é o mesmo lm\n# \"gaussian\" é para dados contínuos, pode ser menor que zero\n# poisson\n\n# Ajustar o modelo aos dados\nglm1 <- glm(nplants ~ trat, family = \"gaussian\",\n           data = exp3)\n\nglm2 <- glm(nplants ~ trat, family = \"poisson\" (link = \"log\"),\n           data = exp3)\n#Informação critério de arcaique - quanto menor o AIC, melhor o modelo\nAIC(glm1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 185.0449\n```\n:::\n\n```{.r .cell-code}\nAIC(glm2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 183.9324\n```\n:::\n\n```{.r .cell-code}\nsummary(glm1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = nplants ~ trat, family = \"gaussian\", data = exp3)\n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  95.7500     2.9529  32.425  < 2e-16 ***\ntrat         -0.7634     0.1306  -5.847 6.97e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for gaussian family taken to be 110.9787)\n\n    Null deviance: 6235.8  on 23  degrees of freedom\nResidual deviance: 2441.5  on 22  degrees of freedom\nAIC: 185.04\n\nNumber of Fisher Scoring iterations: 2\n```\n:::\n\n```{.r .cell-code}\nsummary(glm2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = nplants ~ trat, family = poisson(link = \"log\"), \n    data = exp3)\n\nCoefficients:\n             Estimate Std. Error z value Pr(>|z|)    \n(Intercept)  4.571590   0.029539 154.762  < 2e-16 ***\ntrat        -0.009965   0.001488  -6.697 2.13e-11 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 77.906  on 23  degrees of freedom\nResidual deviance: 29.952  on 22  degrees of freedom\nAIC: 183.93\n\nNumber of Fisher Scoring iterations: 4\n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}