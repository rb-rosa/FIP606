{
  "hash": "ac460ee26907ac9fe19236c01679c3bb",
  "result": {
    "markdown": "---\ntitle: \"**1 Fator**\"\nformat: html\n\nexecute: \n  freeze: auto\n  cache: true\n  warning: false\n---\n\n\nAula 10\n\n## Três ou mais tratamentos\n\nANOVA é feita para níveis categóricos (fator qualitativo). Na ANOVA, queremos saber quem é diferente de quem.\n\nExperimento com um fator e em delineamento inteiramente casualizado para comparar o crescimento micelial de diferentes espécies de um fungo fitopatogênico. A resposta a ser estudada é a TCM = taxa de crescimento micelial.\n\n## Preparo\n\n\n::: {.cell hash='aula10_cache/html/unnamed-chunk-1_79570b42219efb0a84eb066d6d90a591'}\n\n```{.r .cell-code}\nlibrary(readxl)\nlibrary(tidyverse)\nmicelial <- read_excel(\"dados-diversos.xlsx\", \"micelial\")\nhead (micelial)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 3\n  especie   rep   tcm\n  <chr>   <dbl> <dbl>\n1 Fasi        1  1.5 \n2 Fasi        2  1.59\n3 Fasi        3  1.52\n4 Fasi        4  1.52\n5 Fasi        5  1.24\n6 Fasi        6  1.29\n```\n:::\n:::\n\n::: {.cell hash='aula10_cache/html/unnamed-chunk-2_d0ede4389c7f2a1de8aaaa5e5a4d149c'}\n\n```{.r .cell-code}\nmicelial|> \n  ggplot(aes(especie, tcm)) +\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](aula10_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n## Ajustar o modelo usando `aov()`\n\n\n::: {.cell hash='aula10_cache/html/unnamed-chunk-3_04bd7c1b69a56464fa2412bca8d6f91a'}\n\n```{.r .cell-code}\n#Ajustar o modelo\n# <- (atribuiu aov a aov1); ~ (em função de); aov (função ANOVA)\naov1 <- aov(tcm ~ especie, data = micelial)\nsummary(aov1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n            Df Sum Sq Mean Sq F value Pr(>F)\nespecie      4 0.4692 0.11729   1.983  0.117\nResiduals   37 2.1885 0.05915               \n```\n:::\n\n```{.r .cell-code}\n#Não há efeito significativo de espécie P=0.117.\n```\n:::\n\n\n## Testar as premissas\n\nOs prossupostos da ANOVA são normalidade e a homocedasticidade dos dados. Se são normais e apresentam igualdade de variâncias, então pode se realizar ANOVA. Se os dados não forem normais e não apresentarem igualdade, pode-se fazer a transformação dos dados, se não funcionar, utilizar modelos não paramétricos, se não, usar modelo linear generalizao (GLM) ou outros. Falta de homocedasticidade não é tolerável, de normalidade, sim.\n\n\n::: {.cell hash='aula10_cache/html/unnamed-chunk-4_94784c1a8a145311a45d252f371bb03d'}\n\n```{.r .cell-code}\n#Checar as premissas para verificar se o modelo está correto\nlibrary(performance)\ncheck_heteroscedasticity(aov1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nOK: Error variance appears to be homoscedastic (p = 0.175).\n```\n:::\n\n```{.r .cell-code}\n#Resultado: OK. Error variance appears to be homoscedastic (p = 0.175). Significa que as variâncias são homogeneas.Se o p-valor for < 0.05 indica que os dados não são homogeneos.\ncheck_normality(aov1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nOK: residuals appear as normally distributed (p = 0.074).\n```\n:::\n\n```{.r .cell-code}\n#OK: residuals appear as normally distributed (p = 0.074). Significa que há normalidade. Se o p-valor for < 0.05 indica que os dados não apresentam normalidade.\nlibrary(DHARMa)\nplot(simulateResiduals(aov1))\n```\n\n::: {.cell-output-display}\n![](aula10_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\n#Normalidade a direita e variância homogenea a esquerda\n# teste de normalidade\nhist(aov1$residuals)\n```\n\n::: {.cell-output-display}\n![](aula10_files/figure-html/unnamed-chunk-4-2.png){width=672}\n:::\n\n```{.r .cell-code}\nqqnorm(aov1$residuals)\nqqline(aov1$residuals)\n```\n\n::: {.cell-output-display}\n![](aula10_files/figure-html/unnamed-chunk-4-3.png){width=672}\n:::\n\n```{.r .cell-code}\nshapiro.test(aov1$residuals)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tShapiro-Wilk normality test\n\ndata:  aov1$residuals\nW = 0.95101, p-value = 0.07022\n```\n:::\n:::\n\n\n## E quando não atende às premissas?\n\nEfeito de inseticida na mortalidade de insetos (Beall, 1942). The Transformation of data from entomological field experiments, Biometrika, 29, 243--262. Dados no pacote \"datasets\" do R. data(InsectSprays)\n\n\n::: {.cell hash='aula10_cache/html/unnamed-chunk-5_52733c5853bf0c599dd2856618b4e1fa'}\n\n```{.r .cell-code}\n# criando o objeto insects\ninsects <- tibble::as_tibble(InsectSprays) |> \n  dplyr::select(spray, count)\ninsects\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 72 × 2\n   spray count\n   <fct> <dbl>\n 1 A        10\n 2 A         7\n 3 A        20\n 4 A        14\n 5 A        14\n 6 A        12\n 7 A        10\n 8 A        23\n 9 A        17\n10 A        20\n# ℹ 62 more rows\n```\n:::\n:::\n\n::: {.cell hash='aula10_cache/html/unnamed-chunk-6_d51604c3bf1f1fff87051d746fc6700a'}\n\n```{.r .cell-code}\ninsects|> \n  ggplot(aes(spray, count)) +\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](aula10_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='aula10_cache/html/unnamed-chunk-7_10b2c8a8648ee326f244ecb57c444bd7'}\n\n```{.r .cell-code}\naov1 <- aov(count ~ spray, data = insects)\nsummary(aov1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n            Df Sum Sq Mean Sq F value Pr(>F)    \nspray        5   2669   533.8    34.7 <2e-16 ***\nResiduals   66   1015    15.4                   \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nlibrary(performance)\ncheck_heteroscedasticity(aov1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nWarning: Heteroscedasticity (non-constant error variance) detected (p < .001).\n```\n:::\n\n```{.r .cell-code}\n#OK: Error variance appears to be homoscedastic (p = 0.175). Significa que as variâncias não são homogeneas, p < 0.05.\n\n\n# nesse caso, recomenda-se transformar os dados para atender as premissas e então utilizar a ANOVA. Se as transformações não atenderem a homocedasticidade, utilizar teste não paramétrico.\n# alternativa 1: transformar dados originais, se for números. Usar raiz quadrada ou logaritimo\n# sqrt:  raiz quadrada\n# log: logarítimo. se houver valor zero no \"count\" somar 0.5.\naov2 <- aov(sqrt(count) ~ spray, data = insects)\n#aov2 <- aov(log(count+0.5) ~ spray, data = insects)\nsummary(aov2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n            Df Sum Sq Mean Sq F value Pr(>F)    \nspray        5  88.44  17.688    44.8 <2e-16 ***\nResiduals   66  26.06   0.395                   \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\ncheck_heteroscedasticity(aov2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nOK: Error variance appears to be homoscedastic (p = 0.854).\n```\n:::\n\n```{.r .cell-code}\ncheck_normality(aov2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nOK: residuals appear as normally distributed (p = 0.681).\n```\n:::\n\n```{.r .cell-code}\n# atenteu as premissas\n\nlibrary(emmeans)\n# médias por inseticida\n# type = \"response\": para que a média não seja transformada, o inverso da raiz\naov2_means <- emmeans(aov2, ~ spray, type = \"response\")\naov2_means\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n spray response    SE df lower.CL upper.CL\n A        14.14 1.364 66   11.550    17.00\n B        15.03 1.406 66   12.352    17.97\n C         1.55 0.452 66    0.779     2.58\n D         4.68 0.785 66    3.248     6.38\n E         3.27 0.656 66    2.095     4.72\n F        16.15 1.458 66   13.370    19.19\n\nConfidence level used: 0.95 \nIntervals are back-transformed from the sqrt scale \n```\n:::\n:::\n\n\n## Teste de Tukey\n\n\n::: {.cell hash='aula10_cache/html/unnamed-chunk-8_023b651eaeb2e468388d10771778fc77'}\n\n```{.r .cell-code}\n# comparação entre pares\npwpm(aov2_means)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        A       B       C       D       E       F\nA [14.14]  0.9975  <.0001  <.0001  <.0001  0.9145\nB  -0.116 [15.03]  <.0001  <.0001  <.0001  0.9936\nC   2.516   2.632 [ 1.55]  0.0081  0.2513  <.0001\nD   1.596   1.712  -0.919 [ 4.68]  0.7366  <.0001\nE   1.951   2.067  -0.565   0.355 [ 3.27]  <.0001\nF  -0.258  -0.142  -2.774  -1.854  -2.209 [16.15]\n\nRow and column labels: spray\nUpper triangle: P values   adjust = \"tukey\"\nDiagonal: [Estimates] (response)   type = \"response\"\nLower triangle: Comparisons (estimate)   earlier vs. later\n```\n:::\n\n```{.r .cell-code}\n# com letras. O teste de Tukey faz uma comparação múltipla (teste de médias comun mais utilizado). Ele apresenta uma ambiguidade, por exemplo, um tratamento com duas letras, pertencendo a dois grupos.\nlibrary(multcomp)\nlibrary(multcompView)\ncld(aov2_means)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n spray response    SE df lower.CL upper.CL .group\n C         1.55 0.452 66    0.779     2.58  1    \n E         3.27 0.656 66    2.095     4.72  12   \n D         4.68 0.785 66    3.248     6.38   2   \n A        14.14 1.364 66   11.550    17.00    3  \n B        15.03 1.406 66   12.352    17.97    3  \n F        16.15 1.458 66   13.370    19.19    3  \n\nConfidence level used: 0.95 \nIntervals are back-transformed from the sqrt scale \nNote: contrasts are still on the sqrt scale \nP value adjustment: tukey method for comparing a family of 6 estimates \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n:::\n:::\n\n\n## Teste não paramétrico\n\n\n::: {.cell hash='aula10_cache/html/unnamed-chunk-9_d863bff7b3d16882412ab5498db59c94'}\n\n```{.r .cell-code}\n# teste não paramétrico, se não atendeu as premissas da ANOVA mesmo com transformção dos dados.\nkruskal.test(count ~ spray, data = insects)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tKruskal-Wallis rank sum test\n\ndata:  count by spray\nKruskal-Wallis chi-squared = 54.691, df = 5, p-value = 1.511e-10\n```\n:::\n\n```{.r .cell-code}\nlibrary(agricolae)\nkruskal(insects$count, insects$spray, console = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nStudy: insects$count ~ insects$spray\nKruskal-Wallis test's\nTies or no Ties\n\nCritical Value: 54.69134\nDegrees of freedom: 5\nPvalue Chisq  : 1.510845e-10 \n\ninsects$spray,  means of the ranks\n\n  insects.count  r\nA      52.16667 12\nB      54.83333 12\nC      11.45833 12\nD      25.58333 12\nE      19.33333 12\nF      55.62500 12\n\nPost Hoc Analysis\n\nt-Student: 1.996564\nAlpha    : 0.05\nMinimum Significant Difference: 8.462804 \n\nTreatments with the same letter are not significantly different.\n\n  insects$count groups\nF      55.62500      a\nB      54.83333      a\nA      52.16667      a\nD      25.58333      b\nE      19.33333     bc\nC      11.45833      c\n```\n:::\n:::\n\n\n\n\n\n\n\n\n## Modelo linear generalizado\n\nPara publicar artigo, o modelo linear é melhor que transformar os dados originais. É mais elegante usar o glm do que transformar os dados.\n\n\n::: {.cell hash='aula10_cache/html/unnamed-chunk-10_762ccd074e3c13955fe459c4b30e2607'}\n\n```{.r .cell-code}\nglm1 <- glm(count ~ spray,\n         data = insects,\n         family = poisson(link = \"identity\"))\n# poisson: adequado para dados de contagem. Muito utilizado para nematoide.\nplot(simulateResiduals(glm1))\n```\n\n::: {.cell-output-display}\n![](aula10_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# catPred é o mais importante\nsummary(glm1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = count ~ spray, family = poisson(link = \"identity\"), \n    data = insects)\n\nCoefficients:\n            Estimate Std. Error z value Pr(>|z|)    \n(Intercept)  14.5000     1.0992  13.191  < 2e-16 ***\nsprayB        0.8333     1.5767   0.529    0.597    \nsprayC      -12.4167     1.1756 -10.562  < 2e-16 ***\nsprayD       -9.5833     1.2720  -7.534 4.92e-14 ***\nsprayE      -11.0000     1.2247  -8.981  < 2e-16 ***\nsprayF        2.1667     1.6116   1.344    0.179    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 409.041  on 71  degrees of freedom\nResidual deviance:  98.329  on 66  degrees of freedom\nAIC: 376.59\n\nNumber of Fisher Scoring iterations: 3\n```\n:::\n\n```{.r .cell-code}\nglm1_means <- emmeans(glm1, ~ spray)\ncld(glm1_means)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n spray emmean    SE  df asymp.LCL asymp.UCL .group\n C       2.08 0.417 Inf      1.27      2.90  1    \n E       3.50 0.540 Inf      2.44      4.56  12   \n D       4.92 0.640 Inf      3.66      6.17   2   \n A      14.50 1.099 Inf     12.35     16.65    3  \n B      15.33 1.130 Inf     13.12     17.55    3  \n F      16.67 1.179 Inf     14.36     18.98    3  \n\nConfidence level used: 0.95 \nP value adjustment: tukey method for comparing a family of 6 estimates \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}